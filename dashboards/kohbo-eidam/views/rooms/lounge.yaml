#################################################
#                                               #
#              LOUNGE DASHBOARD                 #
#              Kohbo Style for Eidam            #
#                                               #
#################################################

title: Lounge
path: lounge
icon: mdi:sofa
subview: true

type: custom:vertical-layout

cards:
  #################################################
  #                PAGE HEADER                    #
  #################################################
  
  - type: custom:decluttering-card
    template: room_page_top_toolbar
    variables:
      - name: Lounge
      - navigation_path: /lovelace/rooms
      - settings_path: '#lounge_settings'

  #################################################
  #              STATUS CHIPS                     #
  #################################################

  - type: horizontal-stack
    cards:
      # Room State Chip
      - type: custom:button-card
        template: kohbo_chip_card_room_mode
        entity: input_select.house_state
        tap_action:
          action: more-info

      # Temperature Chip
      - type: custom:button-card
        template: kohbo_chip_card
        entity: sensor.lounge_temp_sensor_temperature
        icon: mdi:thermometer
        state_display: >
          [[[ 
            const temp = parseFloat(entity.state);
            return isNaN(temp) ? '--' : Math.round(temp) + 'Â°C';
          ]]]
        styles:
          icon:
            - color: >
                [[[
                  const temp = parseFloat(entity.state);
                  if (temp < 18) return '#3B82F6';
                  if (temp > 23) return '#EF4444';
                  return '#22C55E';
                ]]]

      # Humidity Chip
      - type: custom:button-card
        template: kohbo_chip_card
        entity: sensor.lounge_temp_sensor_humidity
        icon: mdi:water-percent
        state_display: >
          [[[ 
            const h = parseFloat(entity.state);
            return isNaN(h) ? '--' : Math.round(h) + '%';
          ]]]
        styles:
          icon:
            - color: >
                [[[
                  const h = parseFloat(entity.state);
                  if (h < 40 || h > 60) return '#F97316';
                  return '#22C55E';
                ]]]

      # TV Status
      - type: custom:button-card
        template: kohbo_chip_card
        entity: media_player.lounge_samsung_tv
        icon: mdi:television
        state_display: >
          [[[ return entity.state === 'on' ? 'On' : 'Off'; ]]]
        styles:
          icon:
            - color: >
                [[[ return entity.state === 'on' ? 'var(--primary-color)' : 'var(--secondary-text-color)'; ]]]

  #################################################
  #               LIGHT SCENES                    #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Scenes

  - type: horizontal-stack
    cards:
      - type: custom:button-card
        template: kohbo_scene_button
        name: Bright
        icon: mdi:brightness-7
        styles:
          icon:
            - color: '#FCD34D'
        tap_action:
          action: call-service
          service: scene.turn_on
          service_data:
            entity_id: scene.lounge_bright

      - type: custom:button-card
        template: kohbo_scene_button
        name: Relax
        icon: mdi:sofa
        styles:
          icon:
            - color: '#F97316'
        tap_action:
          action: call-service
          service: scene.turn_on
          service_data:
            entity_id: scene.lounge_relax

      - type: custom:button-card
        template: kohbo_scene_button
        name: Movie
        icon: mdi:movie-open
        styles:
          icon:
            - color: '#6366F1'
        tap_action:
          action: call-service
          service: scene.turn_on
          service_data:
            entity_id: scene.lounge_movie

      - type: custom:button-card
        template: kohbo_scene_button
        name: "Off"
        icon: mdi:lightbulb-off
        styles:
          icon:
            - color: 'var(--secondary-text-color)'
        tap_action:
          action: call-service
          service: light.turn_off
          service_data:
            entity_id: light.lounge

  #################################################
  #                   LIGHTS                      #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Lights

  - type: custom:mushroom-light-card
    entity: light.lounge
    name: All Lights
    show_brightness_control: true
    use_light_color: true
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(251, 146, 60, 0.05) 100%);
          border: 1px solid rgba(255, 193, 7, 0.3);
          border-radius: 12px;
        }

  - type: grid
    columns: 2
    square: false
    cards:
      - type: custom:mushroom-light-card
        entity: light.lounge_spot_lights
        name: Spotlights
        show_brightness_control: true
        collapsible_controls: true

      - type: custom:mushroom-light-card
        entity: light.lounge_signe
        name: Signe Floor
        show_brightness_control: true
        show_color_control: true
        use_light_color: true
        collapsible_controls: true

      - type: custom:mushroom-light-card
        entity: light.lounge_iris
        name: Iris
        show_brightness_control: true
        show_color_control: true
        use_light_color: true
        collapsible_controls: true

      - type: custom:mushroom-light-card
        entity: light.lounge_tv_gradient
        name: TV Gradient Strip
        show_brightness_control: true
        show_color_control: true
        use_light_color: true
        collapsible_controls: true

  #################################################
  #                   MEDIA                       #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Media

  - type: grid
    columns: 2
    square: false
    cards:
      - type: custom:button-card
        entity: media_player.lounge_samsung_tv
        name: Samsung TV
        icon: mdi:television
        template: kohbo_device_entity
        tap_action:
          action: more-info

      - type: custom:button-card
        entity: media_player.lounge_sonos_arc
        name: Sonos Arc
        icon: mdi:speaker
        template: kohbo_device_entity
        tap_action:
          action: more-info

      - type: custom:button-card
        entity: media_player.lounge_playstation_5
        name: PlayStation 5
        icon: mdi:sony-playstation
        template: kohbo_device_entity

      - type: custom:button-card
        entity: media_player.lounge_fire_cube
        name: Fire TV Cube
        icon: mdi:fire
        template: kohbo_device_entity

  - type: custom:mushroom-media-player-card
    entity: media_player.lounge_sonos_arc
    name: Sonos Arc
    use_media_info: true
    show_volume_level: true
    volume_controls:
      - volume_mute
      - volume_set
    media_controls:
      - play_pause_stop
    collapsible_controls: true

  #################################################
  #                   CLIMATE                     #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Climate

  - type: custom:mushroom-climate-card
    entity: climate.lounge
    name: Heating
    show_temperature_control: true
    collapsible_controls: true
    card_mod:
      style: |
        ha-card {
          border-radius: 12px;
        }

  #################################################
  #                  DEVICES                      #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Power Strips

  - type: grid
    columns: 2
    square: false
    cards:
      # TV Strip
      - type: custom:button-card
        entity: switch.lounge_tv_strip_plug1
        name: Sonos Arc
        icon: mdi:speaker
        template: kohbo_device_smart_plug_entity

      - type: custom:button-card
        entity: switch.lounge_tv_strip_plug2
        name: Samsung TV
        icon: mdi:television
        template: kohbo_device_smart_plug_entity

      - type: custom:button-card
        entity: switch.lounge_tv_strip_plug3
        name: Sonos Sub
        icon: mdi:speaker
        template: kohbo_device_smart_plug_entity

      - type: custom:button-card
        entity: switch.lounge_tv_strip_plug4
        name: PlayStation 5
        icon: mdi:sony-playstation
        template: kohbo_device_smart_plug_entity

      # Piano Strip
      - type: custom:button-card
        entity: switch.lounge_piano_strip_plug1
        name: Piano
        icon: mdi:piano
        template: kohbo_device_smart_plug_entity

      - type: custom:button-card
        entity: switch.lounge_piano_strip_plug3
        name: Air Purifier
        icon: mdi:air-filter
        template: kohbo_device_smart_plug_entity

  #################################################
  #             SETTINGS POPUP                    #
  #################################################

  - type: vertical-stack
    cards:
      - type: custom:bubble-card
        card_type: pop-up
        hash: '#lounge_settings'
        close_by_clicking_outside: true
        
      - type: custom:button-card
        template: kohbo_popup_page_title
        name: Lounge Settings

      - type: custom:button-card
        template: section_title
        name: Automations

      - type: entities
        entities:
          - entity: switch.adaptive_lighting_lounge
            name: Adaptive Lighting
            icon: mdi:theme-light-dark
            secondary_info: last-changed

          - entity: switch.lounge_hue_sync_box
            name: Hue Sync Box
            icon: mdi:sync
            secondary_info: last-changed
#################################################
#                                               #
#            LUCAS'S ROOM DASHBOARD             #
#            Kohbo Style for Eidam              #
#                                               #
#################################################

title: Lucas's Room
path: lucas-room
icon: mdi:baby-face-outline
subview: true

type: custom:vertical-layout

cards:
  #################################################
  #                PAGE HEADER                    #
  #################################################
  
  - type: custom:decluttering-card
    template: room_page_top_toolbar
    variables:
      - name: Lucas's Room
      - navigation_path: /lovelace/rooms
      - settings_path: '#lucas_settings'

  #################################################
  #              STATUS CHIPS                     #
  #################################################

  - type: horizontal-stack
    cards:
      # Room State Chip
      - type: custom:button-card
        template: kohbo_chip_card_room_mode
        entity: input_select.lucas_room_state
        tap_action:
          action: more-info

      # Temperature Chip
      - type: custom:button-card
        template: kohbo_chip_card
        entity: sensor.lucas_room_temp_temperature
        icon: mdi:thermometer
        state_display: >
          [[[ 
            const temp = parseFloat(entity.state);
            return isNaN(temp) ? '--' : Math.round(temp) + 'Â°C';
          ]]]
        styles:
          icon:
            - color: >
                [[[
                  const temp = parseFloat(entity.state);
                  if (temp < 17) return '#3B82F6';
                  if (temp > 24) return '#EF4444';
                  return '#22C55E';
                ]]]

      # Humidity Chip
      - type: custom:button-card
        template: kohbo_chip_card
        entity: sensor.lucas_room_temp_humidity
        icon: mdi:water-percent
        state_display: >
          [[[ 
            const h = parseFloat(entity.state);
            return isNaN(h) ? '--' : Math.round(h) + '%';
          ]]]
        styles:
          icon:
            - color: >
                [[[
                  const h = parseFloat(entity.state);
                  if (h < 45 || h > 55) return '#F97316';
                  return '#22C55E';
                ]]]

      # Napping Status
      - type: custom:button-card
        template: kohbo_chip_card
        entity: input_boolean.lucas_napping
        icon: mdi:sleep
        state_display: >
          [[[ return entity.state === 'on' ? 'Napping' : 'Awake'; ]]]
        styles:
          card:
            - background: >
                [[[ return entity.state === 'on' ? 'rgba(99, 102, 241, 0.2)' : 'var(--card-background-color)'; ]]]
          icon:
            - color: >
                [[[ return entity.state === 'on' ? '#6366F1' : 'var(--secondary-text-color)'; ]]]
        tap_action:
          action: toggle

  #################################################
  #                  ROUTINES                     #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Routines

  - type: custom:decluttering-card
    template: lucas_routines

  #################################################
  #               LIGHT SCENES                    #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Light Scenes

  - type: horizontal-stack
    cards:
      - type: custom:button-card
        template: kohbo_scene_button
        name: Arise
        icon: mdi:weather-sunny
        styles:
          icon:
            - color: '#F59E0B'
        tap_action:
          action: call-service
          service: scene.turn_on
          service_data:
            entity_id: scene.lucass_room_arise

      - type: custom:button-card
        template: kohbo_scene_button
        name: Storybook
        icon: mdi:book-open-variant
        styles:
          icon:
            - color: '#F97316'
        tap_action:
          action: call-service
          service: scene.turn_on
          service_data:
            entity_id: scene.lucass_room_storybook

      - type: custom:button-card
        template: kohbo_scene_button
        name: Sleepy
        icon: mdi:sleep
        styles:
          icon:
            - color: '#6366F1'
        tap_action:
          action: call-service
          service: scene.turn_on
          service_data:
            entity_id: scene.lucass_room_sleepy

      - type: custom:button-card
        template: kohbo_scene_button
        name: "Off"
        icon: mdi:lightbulb-off
        styles:
          icon:
            - color: 'var(--secondary-text-color)'
        tap_action:
          action: call-service
          service: light.turn_off
          service_data:
            entity_id: light.lucass_room

  #################################################
  #                   LIGHTS                      #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Lights

  - type: custom:mushroom-light-card
    entity: light.lucass_room
    name: All Lights
    show_brightness_control: true
    use_light_color: true
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(135deg, rgba(6, 182, 212, 0.15) 0%, rgba(59, 130, 246, 0.05) 100%);
          border: 1px solid rgba(6, 182, 212, 0.3);
          border-radius: 12px;
        }

  - type: grid
    columns: 2
    square: false
    cards:
      - type: custom:mushroom-light-card
        entity: light.lucass_room_spot_lights
        name: Spotlights
        show_brightness_control: true
        collapsible_controls: true

      - type: custom:mushroom-light-card
        entity: light.lucass_room_pendant_light
        name: Pendant
        show_brightness_control: true
        collapsible_controls: true

      - type: custom:mushroom-light-card
        entity: light.lucass_room_iris
        name: Iris (Nightlight)
        show_brightness_control: true
        show_color_control: true
        use_light_color: true
        collapsible_controls: true

  #################################################
  #                   CLIMATE                     #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Climate

  - type: custom:mushroom-climate-card
    entity: climate.lucas_s_room
    name: Heating
    show_temperature_control: true
    collapsible_controls: true
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
          border: 1px solid rgba(6, 182, 212, 0.2);
          border-radius: 12px;
        }

  - type: custom:mini-graph-card
    entities:
      - entity: sensor.lucas_room_temp_temperature
        name: Temperature
      - entity: sensor.lucas_room_temp_humidity
        name: Humidity
        y_axis: secondary
    hours_to_show: 24
    points_per_hour: 2
    line_width: 2
    height: 100
    show:
      legend: true
    color_thresholds:
      - value: 17
        color: '#3B82F6'
      - value: 20
        color: '#22C55E'
      - value: 24
        color: '#EF4444'

  #################################################
  #                    MEDIA                      #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Media

  - type: custom:mushroom-media-player-card
    entity: media_player.lucas_s_room_echo_show
    name: Echo Show 5
    use_media_info: true
    show_volume_level: true
    volume_controls:
      - volume_mute
      - volume_set
    media_controls:
      - play_pause_stop
    collapsible_controls: true

  #################################################
  #                   CAMERA                      #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Camera

  - type: picture-entity
    entity: camera.lucas_s_room
    name: Lucas's Room Camera
    show_state: false
    camera_view: live
    card_mod:
      style: |
        ha-card {
          border: 2px solid rgba(6, 182, 212, 0.3);
          border-radius: 12px;
          overflow: hidden;
        }

  #################################################
  #                  DEVICES                      #
  #################################################

  - type: custom:button-card
    template: section_title
    name: Devices

  - type: grid
    columns: 2
    square: false
    cards:
      - type: custom:button-card
        entity: switch.lucas_room_strip_plug1
        name: Nanit Camera
        icon: mdi:cctv
        template: kohbo_device_smart_plug_entity

      - type: custom:button-card
        entity: switch.lucas_room_strip_plug3
        name: Air Filter
        icon: mdi:air-filter
        template: kohbo_device_smart_plug_entity

      - type: custom:button-card
        entity: switch.lucas_room_strip_plug4
        name: Humidifier
        icon: mdi:air-humidifier
        template: kohbo_device_smart_plug_entity

  #################################################
  #             SETTINGS POPUP                    #
  #################################################

  - type: vertical-stack
    cards:
      - type: custom:bubble-card
        card_type: pop-up
        hash: '#lucas_settings'
        close_by_clicking_outside: true
        
      - type: custom:button-card
        template: kohbo_popup_page_title
        name: Lucas Room Settings

      - type: custom:button-card
        template: section_title
        name: Automations

      - type: entities
        entities:
          - entity: input_boolean.lucas_napping
            name: Napping Mode
            secondary_info: last-changed

          - entity: switch.adaptive_lighting_lucas_room
            name: Adaptive Lighting
            icon: mdi:theme-light-dark
            secondary_info: last-changed

      - type: custom:button-card
        template: section_title
        name: Schedule

      - type: markdown
        content: |
          | Time | Event |
          |------|-------|
          | 07:00-07:30 | Wake up |
          | 18:00 | Bathtime |
          | 18:45 | Wind down |
          | 19:30 | Bedtime |
{"mappings":"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","sources":["src/editor/weather-forecast-extended-editor.ts","src/types.ts"],"sourcesContent":["import { css, html, LitElement, nothing, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport type { HomeAssistant, LovelaceCardEditor } from \"custom-card-helpers\";\nimport { WEATHER_CONDITIONS } from \"../types\";\nimport type { HeaderChip, WeatherCondition, WeatherForecastExtendedConfig } from \"../types\";\nimport type { ForecastEvent } from \"../weather\";\n\nconst HEADER_CHIP_INDEXES = [0, 1, 2] as const;\n\ntype HeaderChipFieldName =\n  | `header_chip_${1 | 2 | 3}_type`\n  | `header_chip_${1 | 2 | 3}_attribute`\n  | `header_chip_${1 | 2 | 3}_template`\n  | `header_chip_${1 | 2 | 3}_icon`\n  | `header_chip_${1 | 2 | 3}_tap_action`;\n\ntype EditorFormData = WeatherForecastExtendedConfig & Partial<Record<HeaderChipFieldName, any>>;\n\nconst chipTypeFieldName = (index: number): HeaderChipFieldName =>\n  `header_chip_${index + 1}_type` as HeaderChipFieldName;\nconst chipAttributeFieldName = (index: number): HeaderChipFieldName =>\n  `header_chip_${index + 1}_attribute` as HeaderChipFieldName;\nconst chipTemplateFieldName = (index: number): HeaderChipFieldName =>\n  `header_chip_${index + 1}_template` as HeaderChipFieldName;\nconst chipIconFieldName = (index: number): HeaderChipFieldName =>\n  `header_chip_${index + 1}_icon` as HeaderChipFieldName;\nconst chipActionFieldName = (index: number): HeaderChipFieldName =>\n  `header_chip_${index + 1}_tap_action` as HeaderChipFieldName;\n\nconst CHIP_FORM_FIELD_NAMES = HEADER_CHIP_INDEXES.reduce<HeaderChipFieldName[]>((names, index) => {\n  names.push(\n    chipTypeFieldName(index),\n    chipAttributeFieldName(index),\n    chipTemplateFieldName(index),\n    chipIconFieldName(index),\n    chipActionFieldName(index),\n  );\n  return names;\n}, []);\n\nconst CHIP_TYPE_OPTIONS: Array<{ value: \"attribute\" | \"template\"; label: string }> = [\n  { value: \"attribute\", label: \"Attribute\" },\n  { value: \"template\", label: \"Template\" },\n];\n\nconst SOLAR_FORECAST_OPTION = \"solar_forecast\";\nconst FORECAST_OPTIONS_CACHE = new Map<string, { hourly: string[]; daily: string[] }>();\n\nconst ICON_MAP_LABELS: Record<WeatherCondition, string> = {\n  \"clear-night\": \"Clear night\",\n  cloudy: \"Cloudy\",\n  fog: \"Fog\",\n  hail: \"Hail\",\n  lightning: \"Lightning\",\n  \"lightning-rainy\": \"Lightning rainy\",\n  partlycloudy: \"Partly cloudy\",\n  \"partlycloudy-night\": \"Partly cloudy night\",\n  pouring: \"Pouring\",\n  rainy: \"Rainy\",\n  snowy: \"Snowy\",\n  \"snowy-rainy\": \"Snowy rainy\",\n  sunny: \"Sunny\",\n  windy: \"Windy\",\n  \"windy-variant\": \"Windy variant\",\n  exceptional: \"Exceptional\",\n};\n\ntype HaFormSelector =\n  | { entity: { domain?: string; device_class?: string | string[] } }\n  | { boolean: {} }\n  | { text: {} }\n  | { icon: {} }\n  | { ui_action: { actions?: Array<\"tap\" | \"hold\" | \"double_tap\"> } }\n  | { select: { options: Array<{ value: string; label: string }>; custom_value?: boolean; multiple?: boolean } };\n\ntype HaFormSchema = {\n  name: keyof WeatherForecastExtendedConfig | \"entity\" | HeaderChipFieldName;\n  selector: HaFormSelector;\n  optional?: boolean;\n  disabled?: boolean;\n};\n\ntype ToggleName = \"show_header\" | \"hourly_forecast\" | \"daily_forecast\";\n\ntype EnergyPreferences = {\n  energy_sources?: Array<{\n    type?: string;\n    config_entry_solar_forecast?: string[] | null;\n  }>;\n};\n\ntype ConfigEntryFragment = {\n  entry_id: string;\n  title?: string;\n  domain?: string;\n};\n\nconst fireEvent = (node: HTMLElement, type: string, detail?: unknown) => {\n  node.dispatchEvent(new CustomEvent(type, { detail, bubbles: true, composed: true }));\n};\n\ntype ModernForecastType = \"hourly\" | \"daily\" | \"twice_daily\";\nconst WeatherEntityFeature = {\n  FORECAST_DAILY: 1,\n  FORECAST_HOURLY: 2,\n  FORECAST_TWICE_DAILY: 4,\n} as const;\n\n@customElement(\"weather-forecast-extended-editor\")\nexport class WeatherForecastExtendedEditor extends LitElement implements LovelaceCardEditor {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _config?: WeatherForecastExtendedConfig;\n  @state() private _chipTypes: Record<number, \"attribute\" | \"template\"> = {\n    0: \"attribute\",\n    1: \"attribute\",\n    2: \"attribute\",\n  };\n  @state() private _hourlyExtraOptions: string[] = [];\n  @state() private _dailyExtraOptions: string[] = [];\n  @state() private _forecastOptionsLoading: Record<ModernForecastType, boolean> = {\n    hourly: false,\n    daily: false,\n    twice_daily: false,\n  };\n  @state() private _solarForecastOptions: Array<{ value: string; label: string }> = [];\n  @state() private _solarForecastEntryIds: string[] = [];\n  @state() private _expandedSections: Record<string, boolean> = {};\n\n  private _forecastOptionSubscriptions: Partial<Record<ModernForecastType, Promise<() => void> | undefined>> = {};\n  private _forecastOptionsEntity?: string;\n  private _solarForecastOptionsLoaded = false;\n  private _solarForecastOptionsPromise?: Promise<void>;\n\n  static styles = css`\n    .editor-section {\n      margin-top: 24px;\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n\n    .editor-section:first-of-type {\n      margin-top: 16px;\n    }\n\n    .section-title {\n      margin: 0;\n      font-size: 16px;\n      font-weight: 600;\n    }\n\n    .section-subtitle {\n      margin: 0;\n      font-size: 15px;\n      font-weight: 600;\n    }\n\n    .group-card {\n      border: 1px solid var(--divider-color, rgba(0, 0, 0, 0.12));\n      border-radius: 12px;\n      padding: 16px;\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n\n    .editor-subsection {\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    }\n\n    .chips-section {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    }\n\n    .chips-hint {\n      margin: 0;\n      font-size: 14px;\n      color: var(--secondary-text-color);\n    }\n\n    .location-description {\n      font-size: 14px;\n      color: var(--secondary-text-color);\n    }\n\n    .sun-coordinates {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 12px;\n    }\n\n    .color-input-row {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 8px;\n      align-items: center;\n    }\n\n    .color-input-row input[type=\"color\"] {\n      padding: 0;\n      width: 40px;\n      height: 32px;\n      border: none;\n      background: none;\n    }\n\n    .color-input-row input[type=\"text\"] {\n      flex: 1 1 120px;\n      min-width: 120px;\n    }\n\n    .icon-map-list {\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    }\n\n    .icon-map-row {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .icon-map-row ha-selector {\n      flex: 1 1 auto;\n    }\n\n    .clear-button {\n      padding: 4px 8px;\n      border-radius: 4px;\n      border: 1px solid var(--divider-color, rgba(0, 0, 0, 0.12));\n\n      cursor: pointer;\n      font: inherit;\n      color: var(--primary-text-color);\n    }\n\n    .clear-button:hover {\n      background: var(--secondary-background-color, #f5f5f5);\n    }\n\n    .coordinate-field {\n      display: flex;\n      flex: 1 1 120px;\n      flex-direction: column;\n      gap: 4px;\n      font-size: 14px;\n    }\n\n    .coordinate-field input {\n      font: inherit;\n      padding: 6px 8px;\n      border-radius: 4px;\n      border: 1px solid var(--divider-color, rgba(0, 0, 0, 0.12));\n      color: var(--primary-text-color);\n    }\n\n    .coordinate-field input:disabled {\n      opacity: 0.6;\n    }\n\n    .forecast-switch {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 16px;\n    }\n\n    .forecast-switch span {\n      font-size: 14px;\n    }\n\n    .editor-expander {\n      border: 1px solid var(--divider-color, rgba(0, 0, 0, 0.12));\n      border-radius: 12px;\n      overflow: hidden;\n      background: var(--card-background-color, #fff);\n    }\n\n    .editor-expander summary {\n      list-style: none;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 8px;\n      padding: 12px 16px;\n      cursor: pointer;\n      font-size: 15px;\n      font-weight: 600;\n    }\n\n    .editor-expander summary::-webkit-details-marker {\n      display: none;\n    }\n\n    .editor-expander > summary ha-icon {\n      transition: transform 0.2s ease;\n    }\n\n    .editor-expander[open] > summary ha-icon {\n      transform: rotate(180deg);\n    }\n\n    .editor-expander[open] summary {\n      border-bottom: 1px solid var(--divider-color, rgba(0, 0, 0, 0.12));\n    }\n\n    .editor-expander .summary-actions {\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .editor-expander.disabled summary {\n      color: var(--secondary-text-color);\n      cursor: default;\n    }\n\n    .editor-expander.disabled > summary ha-icon {\n      opacity: 0.4;\n    }\n\n    .editor-expander .expander-content {\n      padding: 16px;\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n\n    .editor-expander.nested summary {\n      padding: 10px 12px;\n      font-size: 14px;\n    }\n\n    .editor-expander.nested .expander-content {\n      padding: 12px;\n    }\n  `;\n\n  public setConfig(config: WeatherForecastExtendedConfig): void {\n    const normalizedChips = this._normalizeHeaderChips(config);\n    this._chipTypes = this._buildChipTypeState(normalizedChips);\n\n    this._config = {\n      type: \"custom:weather-forecast-extended-card\",\n      ...config,\n      nowcast_entity: config.nowcast_entity,\n      nowcast_layout: config.nowcast_layout ?? \"pager\",\n      nowcast_always_show: config.nowcast_always_show ?? false,\n      show_header: config.show_header ?? true,\n      hourly_forecast: config.hourly_forecast ?? true,\n      daily_forecast: config.daily_forecast ?? true,\n      orientation: config.orientation ?? \"vertical\",\n      header_chips: normalizedChips,\n      header_attributes: normalizedChips\n        .filter(chip => chip.type === \"attribute\")\n        .map(chip => chip.attribute),\n    };\n\n    this._refreshForecastOptions();\n    this._refreshSolarForecastOptions(true);\n  }\n\n  protected render() {\n    if (!this.hass || !this._config) {\n      return html``;\n    }\n\n    this._refreshForecastOptions();\n    this._ensureSolarForecastOptions();\n\n    const {\n      general: generalSchema,\n      layout: layoutSchema,\n      header: headerSchema,\n      nowcast: nowcastSchema,\n      chips: chipSchema,\n      hourly: hourlySchema,\n      daily: dailySchema,\n    } = this._buildSchemas();\n    const formData = this._createFormData();\n\n    return html`\n      <ha-form\n        .hass=${this.hass}\n        .data=${formData}\n        .schema=${generalSchema}\n        .computeLabel=${this._computeLabel}\n        @value-changed=${this._handleValueChanged}\n      ></ha-form>\n      <div class=\"editor-section\">\n        ${this._renderExpander(\n          \"gps-coordinates\",\n          \"GPS Coordinates\",\n          html`\n            <p class=\"location-description\">\n              Needed for sunrise/sunset markers and day/night backgrounds\n            </p>\n            <div class=\"forecast-switch\">\n              <span>Use Home Assistant location</span>\n              <ha-switch\n                name=\"sun_use_home_coordinates\"\n                .checked=${this._config.sun_use_home_coordinates ?? true}\n                @change=${this._handleSunToggleChange}\n              ></ha-switch>\n            </div>\n            <div class=\"sun-coordinates\">\n              <label class=\"coordinate-field\">\n                <span>Latitude</span>\n                <input\n                  type=\"text\"\n                  name=\"sun_latitude\"\n                  placeholder=\"e.g. 48.137\"\n                  .value=${String(this._config.sun_latitude ?? \"\")}\n                  ?disabled=${this._config.sun_use_home_coordinates ?? true}\n                  @input=${this._handleSunInputChange}\n                />\n              </label>\n              <label class=\"coordinate-field\">\n                <span>Longitude</span>\n                <input\n                  type=\"text\"\n                  name=\"sun_longitude\"\n                  placeholder=\"e.g. 11.575\"\n                  .value=${String(this._config.sun_longitude ?? \"\")}\n                  ?disabled=${this._config.sun_use_home_coordinates ?? true}\n                  @input=${this._handleSunInputChange}\n                />\n              </label>\n            </div>\n          `,\n        )}\n      </div>\n      <div class=\"editor-section\">\n        ${this._renderExpander(\n          \"solar-forecast\",\n          \"Solar Forecast\",\n          html`\n            <p class=\"location-description\">\n              The forecast needs to be assigned to a solar panel configuration in the Energy dashboard settings. Otherwise it can't be used here.\n            </p>\n            <ha-selector\n              .hass=${this.hass}\n              .selector=${{ select: { options: this._solarForecastOptions, multiple: true } }}\n              .value=${this._getSolarForecastSelection()}\n              .label=${\"Energy solar forecasts\"}\n              .required=${false}\n              .disabled=${!this._solarForecastEntryIds.length}\n              @value-changed=${this._handleSolarForecastSelectionChange}\n            ></ha-selector>\n            ${this._solarForecastOptionsLoaded && !this._solarForecastEntryIds.length\n              ? html`<p class=\"location-description\">No Energy solar forecasts configured.</p>`\n              : nothing}\n          `,\n        )}\n      </div>\n      <div class=\"editor-section\">\n        ${this._renderExpander(\n          \"custom-icons\",\n          \"Custom Icons\",\n          html`\n            <p class=\"location-description\">\n              Override the default weather icons with any icon available in Home Assistant.\n            </p>\n            <div class=\"icon-map-list\">\n              ${WEATHER_CONDITIONS.map(condition => {\n                const value = this._getIconMapValue(condition);\n                return html`\n                  <div class=\"icon-map-row\">\n                    <ha-selector\n                      .hass=${this.hass}\n                      .selector=${{ icon: {} }}\n                      .value=${value}\n                      .label=${ICON_MAP_LABELS[condition]}\n                      .required=${false}\n                      @value-changed=${(event: CustomEvent) => this._handleIconMapChange(condition, event)}\n                    ></ha-selector>\n                  </div>\n                `;\n              })}\n            </div>\n          `,\n        )}\n      </div>\n      <div class=\"editor-section\">\n        ${this._renderToggleExpander(\n          \"header\",\n          \"Header\",\n          \"show_header\",\n          html`\n            <ha-form\n              .hass=${this.hass}\n              .data=${formData}\n              .schema=${headerSchema}\n              .computeLabel=${this._computeLabel}\n              @value-changed=${this._handleValueChanged}\n            ></ha-form>\n            <div class=\"editor-subsection\">\n              <h5 class=\"section-subtitle\">Tap actions</h5>\n              <p class=\"chips-hint\">Tap-only actions for the temperature and condition pills.</p>\n              <ha-selector\n                .hass=${this.hass}\n                .selector=${{ ui_action: {} }}\n                .value=${this._config.header_tap_action_temperature}\n                .label=${\"Temperature tap action\"}\n                .required=${false}\n                .disabled=${this._config.show_header === false}\n                @value-changed=${(event: CustomEvent) =>\n                  this._handleHeaderActionChange(event, \"header_tap_action_temperature\")}\n              ></ha-selector>\n              <ha-selector\n                .hass=${this.hass}\n                .selector=${{ ui_action: {} }}\n                .value=${this._config.header_tap_action_condition}\n                .label=${\"Condition tap action\"}\n                .required=${false}\n                .disabled=${this._config.show_header === false}\n                @value-changed=${(event: CustomEvent) =>\n                  this._handleHeaderActionChange(event, \"header_tap_action_condition\")}\n              ></ha-selector>\n            </div>\n            ${this._renderExpander(\n              \"header-chips\",\n              \"Chips\",\n              html`\n                <p class=\"chips-hint\">Choose Attribute or Template for up to three header chips.</p>\n                <ha-form\n                  .hass=${this.hass}\n                  .data=${formData}\n                  .schema=${chipSchema}\n                  .computeLabel=${this._computeLabel}\n                  @value-changed=${this._handleValueChanged}\n                ></ha-form>\n              `,\n              { nested: true },\n            )}\n            ${this._renderExpander(\n              \"header-nowcast\",\n              \"Nowcast\",\n              html`\n                <p class=\"location-description\">\n                  Controls the minute-by-minute precipitation chart shown inside the header.\n                </p>\n                <ha-form\n                  .hass=${this.hass}\n                  .data=${formData}\n                  .schema=${nowcastSchema}\n                  .computeLabel=${this._computeLabel}\n                  @value-changed=${this._handleValueChanged}\n                ></ha-form>\n              `,\n              { nested: true },\n            )}\n          `,\n        )}\n      </div>\n      <div class=\"editor-section\">\n        ${this._renderToggleExpander(\n          \"daily-forecast\",\n          \"Daily forecast\",\n          \"daily_forecast\",\n          html`\n            <ha-form\n              .hass=${this.hass}\n              .data=${formData}\n              .schema=${dailySchema}\n              .computeLabel=${this._computeLabel}\n              @value-changed=${this._handleValueChanged}\n            ></ha-form>\n            ${this._forecastOptionsLoading.daily && !this._dailyExtraOptions.length\n              ? html`<p class=\"location-description\">Loading available weather attributes...</p>`\n              : nothing}\n            <div class=\"sun-coordinates\">\n              <label class=\"coordinate-field\">\n                <span>Extra attribute color</span>\n                <div class=\"color-input-row\">\n                  <input\n                    type=\"color\"\n                    name=\"daily_extra_attribute_color\"\n                    .value=${this._getColorPickerValue(this._config.daily_extra_attribute_color)}\n                    @input=${this._handleColorPickerChange}\n                  />\n                  <input\n                    type=\"text\"\n                    name=\"daily_extra_attribute_color\"\n                    placeholder=\"#30b3ff\"\n                    .value=${String(this._config.daily_extra_attribute_color ?? \"\")}\n                    @input=${this._handleSunInputChange}\n                  />\n                  <button\n                    class=\"clear-button\"\n                    type=\"button\"\n                    @click=${() => this._clearOptionalField(\"daily_extra_attribute_color\")}\n                  >\n                    Clear\n                  </button>\n                </div>\n              </label>\n              <label class=\"coordinate-field\">\n                <span>Dim values smaller than:</span>\n                <input\n                  type=\"number\"\n                  name=\"daily_extra_attribute_dim_below\"\n                  step=\"0.1\"\n                  placeholder=\"No threshold\"\n                  .value=${String(this._config.daily_extra_attribute_dim_below ?? \"\")}\n                  @input=${this._handleOptionalNumberInputChange}\n                />\n              </label>\n            </div>\n            <div class=\"editor-subsection\">\n              <h5 class=\"section-subtitle\">Forecast spacing</h5>\n              <p class=\"location-description\">\n                Minimum distance between forecast items in pixels (10px or greater)\n              </p>\n              <div class=\"sun-coordinates\">\n                <label class=\"coordinate-field\">\n                  <span>Daily min gap (px)</span>\n                  <input\n                    type=\"number\"\n                    name=\"daily_min_gap\"\n                    min=\"10\"\n                    step=\"1\"\n                    placeholder=\"Default 30\"\n                    .value=${String(this._config.daily_min_gap ?? \"\")}\n                    @input=${this._handleSunInputChange}\n                  />\n                </label>\n              </div>\n            </div>\n          `,\n        )}\n      </div>\n      <div class=\"editor-section\">\n        ${this._renderToggleExpander(\n          \"hourly-forecast\",\n          \"Hourly forecast\",\n          \"hourly_forecast\",\n          html`\n            <ha-form\n              .hass=${this.hass}\n              .data=${formData}\n              .schema=${hourlySchema}\n              .computeLabel=${this._computeLabel}\n              @value-changed=${this._handleValueChanged}\n            ></ha-form>\n            ${this._forecastOptionsLoading.hourly && !this._hourlyExtraOptions.length\n              ? html`<p class=\"location-description\">Loading available weather attributes...</p>`\n              : nothing}\n            <div class=\"sun-coordinates\">\n              <label class=\"coordinate-field\">\n                <span>Extra attribute color</span>\n                <div class=\"color-input-row\">\n                  <input\n                    type=\"color\"\n                    name=\"hourly_extra_attribute_color\"\n                    .value=${this._getColorPickerValue(this._config.hourly_extra_attribute_color)}\n                    @input=${this._handleColorPickerChange}\n                  />\n                  <input\n                    type=\"text\"\n                    name=\"hourly_extra_attribute_color\"\n                    placeholder=\"#30b3ff\"\n                    .value=${String(this._config.hourly_extra_attribute_color ?? \"\")}\n                    @input=${this._handleSunInputChange}\n                  />\n                  <button\n                    class=\"clear-button\"\n                    type=\"button\"\n                    @click=${() => this._clearOptionalField(\"hourly_extra_attribute_color\")}\n                  >\n                    Clear\n                  </button>\n                </div>\n              </label>\n              <label class=\"coordinate-field\">\n                <span>Dim values smaller than:</span>\n                <input\n                  type=\"number\"\n                  name=\"hourly_extra_attribute_dim_below\"\n                  step=\"0.1\"\n                  placeholder=\"No threshold\"\n                  .value=${String(this._config.hourly_extra_attribute_dim_below ?? \"\")}\n                  @input=${this._handleOptionalNumberInputChange}\n                />\n              </label>\n            </div>\n            <div class=\"editor-subsection\">\n              <h5 class=\"section-subtitle\">Sunrise & Sunset</h5>\n              <div class=\"forecast-switch\">\n                <span>Show sunrise & sunset</span>\n                <ha-switch\n                  name=\"show_sun_times\"\n                  .checked=${this._config.show_sun_times ?? false}\n                  @change=${this._handleSunToggleChange}\n                ></ha-switch>\n              </div>\n            </div>\n            <div class=\"editor-subsection\">\n              <h5 class=\"section-subtitle\">Forecast spacing</h5>\n              <p class=\"location-description\">\n                Minimum distance between forecast items in pixels (10px or greater)\n              </p>\n              <div class=\"sun-coordinates\">\n                <label class=\"coordinate-field\">\n                  <span>Hourly min gap (px)</span>\n                  <input\n                    type=\"number\"\n                    name=\"hourly_min_gap\"\n                    min=\"10\"\n                    step=\"1\"\n                    placeholder=\"Default 16\"\n                    .value=${String(this._config.hourly_min_gap ?? \"\")}\n                    @input=${this._handleSunInputChange}\n                  />\n                </label>\n              </div>\n            </div>\n          `,\n        )}\n      </div>\n      ${this._config.daily_forecast !== false && this._config.hourly_forecast !== false\n        ? html`\n            <div class=\"editor-section\">\n              <h4 class=\"section-title\">Orientation</h4>\n              <div class=\"group-card\">\n                <ha-form\n                  .hass=${this.hass}\n                  .data=${formData}\n                  .schema=${layoutSchema}\n                  .computeLabel=${this._computeLabel}\n                  @value-changed=${this._handleValueChanged}\n                ></ha-form>\n              </div>\n            </div>\n          `\n        : nothing}\n    `;\n  }\n\n  private _handleValueChanged(event: CustomEvent<{ value: EditorFormData }>) {\n    event.stopPropagation();\n    const mergedFormValue: EditorFormData = {\n      ...this._createFormData(),\n      ...event.detail.value,\n    };\n\n    const chipTypesUpdate: Record<number, \"attribute\" | \"template\"> = { ...this._chipTypes };\n    HEADER_CHIP_INDEXES.forEach(index => {\n      const typeField = chipTypeFieldName(index);\n      const typeValue = (mergedFormValue[typeField] as \"attribute\" | \"template\" | undefined) ?? \"attribute\";\n      chipTypesUpdate[index] = typeValue === \"template\" ? \"template\" : \"attribute\";\n    });\n    this._chipTypes = chipTypesUpdate;\n\n    const headerChips = this._extractHeaderChips(mergedFormValue);\n\n    const configUpdate: Partial<WeatherForecastExtendedConfig> = {\n      ...mergedFormValue,\n      header_chips: headerChips,\n      header_attributes: headerChips\n        .filter(chip => chip.type === \"attribute\")\n        .map(chip => chip.attribute)\n        .filter(attribute => typeof attribute === \"string\" && attribute.trim().length > 0),\n    };\n\n    CHIP_FORM_FIELD_NAMES.forEach(name => {\n      delete (configUpdate as Record<string, unknown>)[name];\n    });\n\n    this._updateConfig(configUpdate);\n  }\n\n  private _computeLabel = (schema: HaFormSchema) => {\n    if (!this.hass) {\n      return schema.name;\n    }\n\n    switch (schema.name) {\n      case \"entity\":\n        return \"Weather Entity\";\n      case \"header_temperature_entity\":\n        return \"Local Temperature Sensor Entity (Overrides the current temperature value of the forecast)\";\n      case \"show_header\":\n        return this.hass.localize(\"ui.panel.lovelace.editor.card.generic.show_header\") || \"Show header\";\n      case \"hourly_forecast\":\n        return this.hass.localize(\"ui.panel.lovelace.editor.card.weather.show_forecast_hourly\") || \"Show hourly forecast\";\n      case \"daily_forecast\":\n        return this.hass.localize(\"ui.panel.lovelace.editor.card.weather.show_forecast_daily\") || \"Show daily forecast\";\n      case \"orientation\":\n        return this.hass.localize(\"ui.panel.lovelace.editor.card.generic.orientation\") || \"Orientation\";\n      case \"use_night_header_backgrounds\":\n        return \"Use separate header backgrounds for nightly conditions\";\n      case \"nowcast_entity\":\n        return \"Nowcast Entity (For next-hour precipitation. The entity integration must provide a get_minute_forecast action to fetch the data.)\";\n      case \"nowcast_layout\":\n        return \"Nowcast layout\";\n      case \"nowcast_always_show\":\n        return \"Always show nowcast\";\n      case \"hourly_extra_attribute\":\n        return \"Hourly extra attribute (third line)\";\n      case \"hourly_extra_attribute_unit\":\n        return \"Unit for hourly extra attribute\";\n      case \"daily_extra_attribute\":\n        return \"Daily extra attribute (third line)\";\n      case \"daily_extra_attribute_unit\":\n        return \"Unit for daily extra attribute\";\n      default:\n        if (typeof schema.name === \"string\" && schema.name.startsWith(\"header_chip_\")) {\n          const parts = schema.name.split(\"_\");\n          const indexStr = parts[2];\n          const index = Number(indexStr);\n          const labelIndex = Number.isFinite(index) && index > 0 ? index : 1;\n          if (schema.name.endsWith(\"_type\")) {\n            return `Header chip ${labelIndex}: mode`;\n          }\n          if (schema.name.endsWith(\"_attribute\")) {\n            return `Header chip ${labelIndex}: attribute`;\n          }\n          if (schema.name.endsWith(\"_template\")) {\n            return `Header chip ${labelIndex}: template`;\n          }\n          if (schema.name.endsWith(\"_icon\")) {\n            return `Header chip ${labelIndex}: icon`;\n          }\n          if (schema.name.endsWith(\"_tap_action\")) {\n            return `Header chip ${labelIndex}: tap action`;\n          }\n          return `Header chip ${labelIndex}`;\n        }\n        return schema.name;\n    }\n  };\n\n  private _handleSunToggleChange(event: Event) {\n    const target = event.currentTarget as (HTMLElement & { name?: string; checked?: boolean }) | null;\n    if (!target) {\n      return;\n    }\n    const name = target.getAttribute(\"name\") ?? target.name;\n    if (!name) {\n      return;\n    }\n    const key = name as keyof WeatherForecastExtendedConfig;\n    const isChecked = typeof target.checked === \"boolean\" ? target.checked : false;\n    this._updateConfig({ [key]: isChecked } as Partial<WeatherForecastExtendedConfig>);\n  }\n\n  private _handleSunInputChange(event: Event) {\n    const target = event.currentTarget as HTMLInputElement | null;\n    if (!target) {\n      return;\n    }\n    const key = target.name as keyof WeatherForecastExtendedConfig;\n    const value = target.value.trim();\n    const update: Partial<WeatherForecastExtendedConfig> = {};\n    (update as any)[key] = value === \"\" ? undefined : value;\n    this._updateConfig(update);\n  }\n\n  private _handleExpanderToggle(event: Event, id: string) {\n    const target = event.currentTarget as HTMLDetailsElement | null;\n    if (!target) {\n      return;\n    }\n    this._expandedSections = { ...this._expandedSections, [id]: target.open };\n  }\n\n  private _handleExpanderSummaryClick(event: Event, disabled: boolean) {\n    if (!disabled) {\n      return;\n    }\n    event.preventDefault();\n  }\n\n  private _isToggleDisabled(name: ToggleName, config: WeatherForecastExtendedConfig): boolean {\n    const toggleNames: ToggleName[] = [\"show_header\", \"daily_forecast\", \"hourly_forecast\"];\n    const enabledCount = toggleNames.reduce((count, key) =>\n      this._isSectionEnabled(key, config) ? count + 1 : count,\n    0);\n    return enabledCount <= 1 && this._isSectionEnabled(name, config);\n  }\n\n  private _handleOptionalNumberInputChange(event: Event) {\n    const target = event.currentTarget as HTMLInputElement | null;\n    if (!target) {\n      return;\n    }\n    const key = target.name as keyof WeatherForecastExtendedConfig;\n    const raw = target.value.trim();\n    const update: Partial<WeatherForecastExtendedConfig> = {};\n    if (raw === \"\") {\n      (update as any)[key] = undefined;\n    } else {\n      const numericValue = Number(raw);\n      (update as any)[key] = Number.isFinite(numericValue) ? numericValue : undefined;\n    }\n    this._updateConfig(update);\n  }\n\n  private _handleColorPickerChange(event: Event) {\n    const target = event.currentTarget as HTMLInputElement | null;\n    if (!target) {\n      return;\n    }\n    const key = target.name as keyof WeatherForecastExtendedConfig;\n    const value = target.value.trim();\n    const update: Partial<WeatherForecastExtendedConfig> = {};\n    (update as any)[key] = value === \"\" ? undefined : value;\n    this._updateConfig(update);\n  }\n\n  private _clearOptionalField(field: keyof WeatherForecastExtendedConfig) {\n    this._updateConfig({ [field]: undefined } as Partial<WeatherForecastExtendedConfig>);\n  }\n\n  private _getIconMapValue(condition: WeatherCondition): string {\n    const iconMap = this._config?.icon_map;\n    if (!iconMap) {\n      return \"\";\n    }\n    const value = iconMap[condition];\n    return typeof value === \"string\" ? value : \"\";\n  }\n\n  private _handleIconMapChange(condition: WeatherCondition, event: CustomEvent<{ value?: unknown }>) {\n    event.stopPropagation();\n    if (!this._config) {\n      return;\n    }\n    const raw = event.detail?.value;\n    const value = typeof raw === \"string\" ? raw.trim() : \"\";\n    const nextMap = { ...(this._config.icon_map ?? {}) };\n\n    if (!value) {\n      delete (nextMap as Partial<Record<WeatherCondition, string>>)[condition];\n    } else {\n      (nextMap as Partial<Record<WeatherCondition, string>>)[condition] = value;\n    }\n\n    this._updateConfig({ icon_map: Object.keys(nextMap).length ? nextMap : undefined });\n  }\n\n  private _getColorPickerValue(value?: string): string {\n    if (!value) {\n      return \"#000000\";\n    }\n    const trimmed = value.trim();\n    const hexMatch = /^#([0-9a-fA-F]{3}){1,2}$/.test(trimmed);\n    if (!hexMatch) {\n      return \"#000000\";\n    }\n    if (trimmed.length === 4) {\n      const [r, g, b] = trimmed.slice(1).split(\"\");\n      return `#${r}${r}${g}${g}${b}${b}`;\n    }\n    return trimmed;\n  }\n\n  private _handleHeaderActionChange(\n    event: CustomEvent<{ value?: unknown }>,\n    field: \"header_tap_action_temperature\" | \"header_tap_action_condition\",\n  ) {\n    event.stopPropagation();\n    const value = event.detail?.value;\n    const update: Partial<WeatherForecastExtendedConfig> = {\n      [field]: value || undefined,\n    };\n    this._updateConfig(update);\n  }\n\n  private _handleSolarForecastSelectionChange(event: CustomEvent<{ value?: unknown }>) {\n    event.stopPropagation();\n    const raw = event.detail?.value;\n    const selection = Array.isArray(raw) ? raw.filter(item => typeof item === \"string\") : [];\n    const available = this._solarForecastEntryIds;\n    const normalized = selection.filter(entryId => available.includes(entryId));\n    const update: Partial<WeatherForecastExtendedConfig> = {};\n\n    if (!normalized.length) {\n      update.solar_forecast_entries = [];\n    } else if (normalized.length === available.length) {\n      update.solar_forecast_entries = undefined;\n    } else {\n      update.solar_forecast_entries = normalized;\n    }\n\n    this._updateConfig(update);\n  }\n\n  private _getSolarForecastSelection(): string[] {\n    if (this._config?.solar_forecast_entries) {\n      return this._config.solar_forecast_entries;\n    }\n\n    return this._solarForecastEntryIds;\n  }\n\n  private _createFormData(): EditorFormData {\n    if (!this._config) {\n      return {} as EditorFormData;\n    }\n\n    const formData: EditorFormData = {\n      ...this._config,\n    };\n\n    const headerChips = this._config.header_chips ?? [];\n\n    HEADER_CHIP_INDEXES.forEach(index => {\n      const typeField = chipTypeFieldName(index);\n      const attributeField = chipAttributeFieldName(index);\n      const templateField = chipTemplateFieldName(index);\n      const iconField = chipIconFieldName(index);\n      const actionField = chipActionFieldName(index);\n      const configuredChip = headerChips[index];\n      const type = this._chipTypes[index] ?? configuredChip?.type ?? \"attribute\";\n\n      formData[typeField] = type;\n      formData[actionField] = configuredChip?.tap_action;\n      formData[iconField] = configuredChip?.icon ?? \"\";\n\n      if (type === \"template\") {\n        formData[templateField] = configuredChip?.type === \"template\" ? configuredChip.template : \"\";\n        formData[attributeField] = \"\";\n      } else {\n        formData[attributeField] = configuredChip?.type === \"attribute\" ? configuredChip.attribute : \"\";\n        formData[templateField] = \"\";\n      }\n    });\n\n    return formData;\n  }\n\n  private _renderExpander(\n    id: string,\n    title: string,\n    content: TemplateResult,\n    options: { open?: boolean; nested?: boolean } = {},\n  ): TemplateResult {\n    const className = options.nested ? \"editor-expander nested\" : \"editor-expander\";\n    const isOpen = this._expandedSections[id] ?? options.open ?? false;\n    return html`\n      <details\n        class=${className}\n        ?open=${isOpen}\n        @toggle=${(event: Event) => this._handleExpanderToggle(event, id)}\n      >\n        <summary>\n          <span>${title}</span>\n          <ha-icon icon=\"mdi:chevron-down\"></ha-icon>\n        </summary>\n        <div class=\"expander-content\">\n          ${content}\n        </div>\n      </details>\n    `;\n  }\n\n  private _renderToggleExpander(\n    id: string,\n    title: string,\n    toggleName: ToggleName,\n    content: TemplateResult,\n    options: { open?: boolean } = {},\n  ): TemplateResult {\n    const config = this._config;\n    if (!config) {\n      return nothing;\n    }\n    const isEnabled = this._isSectionEnabled(toggleName, config);\n    const toggleDisabled = this._isToggleDisabled(toggleName, config);\n    const isOpen = isEnabled && (this._expandedSections[id] ?? options.open ?? false);\n    const className = `editor-expander${isEnabled ? \"\" : \" disabled\"}`;\n\n    return html`\n      <details\n        class=${className}\n        ?open=${isOpen}\n        @toggle=${(event: Event) => this._handleExpanderToggle(event, id)}\n      >\n        <summary @click=${(event: Event) => this._handleExpanderSummaryClick(event, !isEnabled)}>\n          <span>${title}</span>\n          <span class=\"summary-actions\">\n            <ha-switch\n              class=\"expander-toggle\"\n              name=${toggleName}\n              .checked=${isEnabled}\n              ?disabled=${toggleDisabled}\n              @click=${(event: Event) => event.stopPropagation()}\n              @change=${this._handleSunToggleChange}\n            ></ha-switch>\n            <ha-icon icon=\"mdi:chevron-down\"></ha-icon>\n          </span>\n        </summary>\n        <div class=\"expander-content\">\n          ${content}\n        </div>\n      </details>\n    `;\n  }\n\n  private _ensureSolarForecastOptions() {\n    this._refreshSolarForecastOptions(false);\n  }\n\n  private _refreshSolarForecastOptions(force: boolean) {\n    if (!this.hass || this._solarForecastOptionsPromise) {\n      return;\n    }\n    if (!force && this._solarForecastOptionsLoaded) {\n      return;\n    }\n\n    this._solarForecastOptionsPromise = this._fetchSolarForecastOptions()\n      .finally(() => {\n        this._solarForecastOptionsPromise = undefined;\n      });\n  }\n\n  private async _fetchSolarForecastOptions() {\n    try {\n      const prefs = await this.hass.callWS<EnergyPreferences>({ type: \"energy/get_prefs\" });\n      const entryIds = this._extractSolarForecastEntries(prefs);\n      const entries = await this.hass.callWS<ConfigEntryFragment[]>({ type: \"config_entries/get\" });\n      const entryMap = new Map(entries.map(entry => [entry.entry_id, entry]));\n      const options = entryIds.map(entryId => {\n        const entry = entryMap.get(entryId);\n        const title = entry?.title?.trim();\n        const domain = entry?.domain?.trim();\n        const labelParts = [];\n        if (title) {\n          labelParts.push(title);\n        }\n        if (domain) {\n          labelParts.push(domain);\n        }\n        const label = labelParts.length ? labelParts.join(\" - \") : entryId;\n        return { value: entryId, label };\n      });\n\n      this._solarForecastOptions = options;\n      this._solarForecastEntryIds = entryIds;\n    } catch (_err) {\n      this._solarForecastOptions = [];\n      this._solarForecastEntryIds = [];\n    }\n\n    this._solarForecastOptionsLoaded = true;\n  }\n\n  private _extractSolarForecastEntries(prefs?: EnergyPreferences): string[] {\n    const energySources = prefs?.energy_sources ?? [];\n    const entries = new Set<string>();\n\n    energySources.forEach(source => {\n      if (source?.type !== \"solar\") {\n        return;\n      }\n      const configured = source.config_entry_solar_forecast;\n      if (!Array.isArray(configured)) {\n        return;\n      }\n      configured.forEach(entryId => {\n        if (typeof entryId === \"string\" && entryId.trim().length) {\n          entries.add(entryId);\n        }\n      });\n    });\n\n    return Array.from(entries);\n  }\n\n  private _extractHeaderChips(formValue: EditorFormData): HeaderChip[] {\n    const chips: HeaderChip[] = [];\n\n    HEADER_CHIP_INDEXES.forEach(index => {\n      const typeField = chipTypeFieldName(index);\n      const attributeField = chipAttributeFieldName(index);\n      const templateField = chipTemplateFieldName(index);\n      const actionField = chipActionFieldName(index);\n      const iconField = chipIconFieldName(index);\n\n      const type = (formValue[typeField] as \"attribute\" | \"template\" | undefined) ?? \"attribute\";\n      const tapAction = formValue[actionField];\n      const iconRaw = formValue[iconField];\n      const iconValue = typeof iconRaw === \"string\" ? iconRaw.trim() : \"\";\n\n      if (type === \"template\") {\n        const templateRaw = formValue[templateField];\n        const templateValue = typeof templateRaw === \"string\" ? templateRaw.trim() : \"\";\n        const chip: HeaderChip = { type: \"template\", template: templateValue };\n        if (tapAction) {\n          (chip as any).tap_action = tapAction;\n        }\n        if (iconValue) {\n          (chip as any).icon = iconValue;\n        }\n        chips.push(chip);\n        return;\n      }\n\n      const attributeRaw = formValue[attributeField];\n      const attributeValue = typeof attributeRaw === \"string\" ? attributeRaw.trim() : \"\";\n      const chip: HeaderChip = { type: \"attribute\", attribute: attributeValue };\n      if (tapAction) {\n        (chip as any).tap_action = tapAction;\n      }\n      if (iconValue) {\n        (chip as any).icon = iconValue;\n      }\n      chips.push(chip);\n    });\n\n    return chips;\n  }\n\n  private _buildAttributeOptions(): Array<{ value: string; label: string }> {\n    if (!this.hass) {\n      return [{ value: \"\", label: \"None\" }];\n    }\n\n    const entityId = this._config?.entity;\n    if (!entityId) {\n      return [{ value: \"\", label: \"None\" }];\n    }\n\n    const entityState = this.hass.states[entityId];\n    if (!entityState) {\n      return [{ value: \"\", label: \"None\" }];\n    }\n\n    const attributeNames = Object.keys(entityState.attributes ?? {}).sort((a, b) => a.localeCompare(b));\n\n    return [\n      { value: \"\", label: \"None\" },\n      ...attributeNames.map(attribute => ({ value: attribute, label: attribute })),\n    ];\n  }\n\n  private _buildHourlyExtraAttributeOptions(): Array<{ value: string; label: string }> {\n    const disallowed = new Set([\n      \"datetime\",\n      \"condition\",\n      \"precipitation\",\n      \"temperature\",\n      \"templow\",\n    ]);\n\n    const options = this._hourlyExtraOptions.length\n      ? this._hourlyExtraOptions.filter(opt => !disallowed.has(opt))\n      : [];\n\n    const solarOption = this._solarForecastEntryIds.length\n      ? [{ value: SOLAR_FORECAST_OPTION, label: \"Solar forecast\" }]\n      : [];\n\n    return [\n      { value: \"\", label: \"None\" },\n      ...solarOption,\n      ...options.map(value => ({ value, label: value })),\n    ];\n  }\n\n  private _buildDailyExtraAttributeOptions(): Array<{ value: string; label: string }> {\n    const disallowed = new Set([\n      \"datetime\",\n      \"condition\",\n      \"precipitation\",\n      \"temperature\",\n      \"templow\",\n    ]);\n\n    const options = this._dailyExtraOptions.length\n      ? this._dailyExtraOptions.filter(opt => !disallowed.has(opt))\n      : [];\n\n    const solarOption = this._solarForecastEntryIds.length\n      ? [{ value: SOLAR_FORECAST_OPTION, label: \"Solar forecast\" }]\n      : [];\n\n    return [\n      { value: \"\", label: \"None\" },\n      ...solarOption,\n      ...options.map(value => ({ value, label: value })),\n    ];\n  }\n\n  private _buildSchemas(): {\n    general: HaFormSchema[];\n    layout: HaFormSchema[];\n    header: HaFormSchema[];\n    nowcast: HaFormSchema[];\n    chips: HaFormSchema[];\n    hourly: HaFormSchema[];\n    daily: HaFormSchema[];\n  } {\n    const generalSchema: HaFormSchema[] = [\n      { name: \"entity\", selector: { entity: { domain: \"weather\" } } },\n    ];\n\n    const layoutSchema: HaFormSchema[] = [\n      {\n        name: \"orientation\",\n        selector: {\n          select: {\n            options: [\n              { value: \"vertical\", label: \"Vertical\" },\n              { value: \"horizontal\", label: \"Horizontal\" },\n            ],\n          },\n        },\n        optional: true,\n      },\n    ];\n\n    const headerSchema: HaFormSchema[] = [\n      {\n        name: \"header_temperature_entity\",\n        selector: { entity: { domain: \"sensor\", device_class: \"temperature\" } },\n        optional: true,\n      },\n      {\n        name: \"use_night_header_backgrounds\",\n        selector: { boolean: {} },\n      },\n    ];\n\n    const nowcastSchema: HaFormSchema[] = [\n      {\n        name: \"nowcast_entity\",\n        selector: { entity: { domain: \"weather\" } },\n        optional: true,\n      },\n      {\n        name: \"nowcast_layout\",\n        selector: {\n          select: {\n            options: [\n              { value: \"pager\", label: \"Header pager\" },\n              { value: \"inline\", label: \"Inline header\" },\n            ],\n          },\n        },\n        optional: true,\n        disabled: !this._config?.nowcast_entity,\n      },\n      {\n        name: \"nowcast_always_show\",\n        selector: { boolean: {} },\n        optional: true,\n        disabled: !this._config?.nowcast_entity,\n      },\n    ];\n\n    const attributeOptions = this._buildAttributeOptions();\n    const hourlySchema: HaFormSchema[] = [\n      {\n        name: \"hourly_extra_attribute\",\n        selector: {\n          select: {\n            options: this._buildHourlyExtraAttributeOptions(),\n            custom_value: true,\n          },\n        },\n        optional: true,\n      },\n      {\n        name: \"hourly_extra_attribute_unit\",\n        selector: { text: {} },\n        optional: true,\n      },\n    ];\n    const dailySchema: HaFormSchema[] = [\n      {\n        name: \"daily_extra_attribute\",\n        selector: {\n          select: {\n            options: this._buildDailyExtraAttributeOptions(),\n            custom_value: true,\n          },\n        },\n        optional: true,\n      },\n      {\n        name: \"daily_extra_attribute_unit\",\n        selector: { text: {} },\n        optional: true,\n        disabled: this._config?.daily_extra_attribute === \"precipitation_probability\",\n      },\n    ];\n    const chipsSchema: HaFormSchema[] = [];\n\n    HEADER_CHIP_INDEXES.forEach(index => {\n      const typeField = chipTypeFieldName(index);\n      chipsSchema.push({\n        name: typeField,\n        selector: {\n          select: {\n            options: CHIP_TYPE_OPTIONS,\n          },\n        },\n        optional: true,\n      });\n\n      const chipType = this._chipTypes[index] ?? \"attribute\";\n      if (chipType === \"template\") {\n        chipsSchema.push({\n          name: chipTemplateFieldName(index),\n          selector: { text: {} },\n          optional: true,\n        });\n      } else {\n        chipsSchema.push({\n          name: chipAttributeFieldName(index),\n          selector: {\n            select: {\n              options: attributeOptions,\n              custom_value: true,\n            },\n          },\n          optional: true,\n          disabled: !this._config?.entity,\n        });\n      }\n\n      chipsSchema.push({\n        name: chipIconFieldName(index),\n        selector: { icon: {} },\n        optional: true,\n      });\n\n      chipsSchema.push({\n        name: chipActionFieldName(index),\n        selector: { ui_action: {} },\n        optional: true,\n      });\n    });\n\n    return {\n      general: generalSchema,\n      layout: layoutSchema,\n      header: headerSchema,\n      nowcast: nowcastSchema,\n      chips: chipsSchema,\n      hourly: hourlySchema,\n      daily: dailySchema,\n    };\n  }\n\n  private _isSectionEnabled(name: ToggleName, config: WeatherForecastExtendedConfig): boolean {\n    const value = config[name];\n    return value !== false;\n  }\n\n  private _normalizeHeaderChips(config: Partial<WeatherForecastExtendedConfig>): HeaderChip[] {\n    const limit = HEADER_CHIP_INDEXES.length;\n    const normalized: HeaderChip[] = [];\n\n    if (Array.isArray(config.header_chips)) {\n      for (const chip of config.header_chips) {\n        if (normalized.length >= limit || !chip || typeof chip !== \"object\") {\n          continue;\n        }\n\n        if (chip.type === \"attribute\") {\n          const attribute = typeof chip.attribute === \"string\" ? chip.attribute.trim() : \"\";\n          const tap_action = chip.tap_action;\n          const icon = typeof chip.icon === \"string\" ? chip.icon.trim() : undefined;\n          normalized.push({ type: \"attribute\", attribute, tap_action, icon });\n          continue;\n        }\n\n        if (chip.type === \"template\") {\n          const template = typeof chip.template === \"string\" ? chip.template.trim() : \"\";\n          const tap_action = chip.tap_action;\n          const icon = typeof chip.icon === \"string\" ? chip.icon.trim() : undefined;\n          normalized.push({ type: \"template\", template, tap_action, icon });\n        }\n      }\n    }\n\n    if (normalized.length) {\n      return normalized.slice(0, limit);\n    }\n\n    const attributeEntries = Array.isArray(config.header_attributes)\n      ? config.header_attributes\n        .filter((attr, index) => index < limit && typeof attr === \"string\")\n        .map(attr => attr.trim())\n        .filter(attr => attr.length > 0)\n      : [];\n\n    return attributeEntries.map(attribute => ({ type: \"attribute\", attribute }));\n  }\n\n  private _buildChipTypeState(chips: HeaderChip[]): Record<number, \"attribute\" | \"template\"> {\n    const types: Record<number, \"attribute\" | \"template\"> = {\n      0: \"attribute\",\n      1: \"attribute\",\n      2: \"attribute\",\n    };\n\n    chips.slice(0, HEADER_CHIP_INDEXES.length).forEach((chip, index) => {\n      if (chip.type === \"template\") {\n        types[index] = \"template\";\n      }\n    });\n\n    return types;\n  }\n\n  private _updateConfig(changes: Partial<WeatherForecastExtendedConfig>) {\n    if (!this._config) {\n      return;\n    }\n\n    const updated: WeatherForecastExtendedConfig = {\n      ...this._config,\n      ...changes,\n      type: \"custom:weather-forecast-extended-card\",\n    };\n\n    if (\"solar_forecast_entries\" in changes && changes.solar_forecast_entries === undefined) {\n      delete (updated as Partial<WeatherForecastExtendedConfig>).solar_forecast_entries;\n    }\n\n    const normalizedChips = this._normalizeHeaderChips(updated);\n    updated.header_chips = normalizedChips;\n    updated.header_attributes = normalizedChips\n      .filter(chip => chip.type === \"attribute\")\n      .map(chip => chip.attribute)\n      .filter(attribute => typeof attribute === \"string\" && attribute.trim().length > 0);\n\n    this._config = updated;\n    fireEvent(this, \"config-changed\", { config: updated });\n  }\n\n  private _refreshForecastOptions() {\n    try {\n      if (!this.hass || !this._config?.entity) {\n        this._teardownForecastOptionSubscriptions();\n        if (this._hourlyExtraOptions.length || this._dailyExtraOptions.length) {\n          this._hourlyExtraOptions = [];\n          this._dailyExtraOptions = [];\n        }\n        this._forecastOptionsLoading = { hourly: false, daily: false, twice_daily: false };\n        this._forecastOptionsEntity = undefined;\n        return;\n      }\n\n      const entityId = this._config.entity;\n      if (this._forecastOptionsEntity !== entityId) {\n        this._teardownForecastOptionSubscriptions();\n        const cached = FORECAST_OPTIONS_CACHE.get(entityId);\n        if (cached) {\n          this._hourlyExtraOptions = cached.hourly;\n          this._dailyExtraOptions = cached.daily;\n          this._forecastOptionsLoading = { hourly: false, daily: false, twice_daily: false };\n        } else {\n          this._forecastOptionsLoading = { hourly: false, daily: false, twice_daily: false };\n        }\n        this._forecastOptionsEntity = entityId;\n      }\n\n      const stateObj = this.hass.states[entityId];\n\n      const supported = this._getSupportedForecastTypes(stateObj as any);\n      const needed = new Set<ModernForecastType>();\n      if (supported.includes(\"hourly\")) {\n        needed.add(\"hourly\");\n      }\n      if (supported.includes(\"daily\") || supported.includes(\"twice_daily\")) {\n        needed.add(\"daily\");\n      }\n      if (!needed.size) {\n        needed.add(\"daily\");\n      }\n\n      ([\"hourly\", \"daily\"] as ModernForecastType[]).forEach(type => {\n        if (!needed.has(type)) {\n          this._teardownForecastOptionSubscriptions([type]);\n          this._forecastOptionsLoading = { ...this._forecastOptionsLoading, [type]: false };\n        } else if (!this._forecastOptionSubscriptions[type]) {\n          try {\n            this._forecastOptionSubscriptions[type] = this._subscribeForecast(\n              entityId,\n              type,\n              event => this._handleForecastOptionsEvent(type, event),\n            );\n            const hasOptions = type === \"hourly\" ? this._hourlyExtraOptions.length : this._dailyExtraOptions.length;\n            if (!hasOptions) {\n              this._forecastOptionsLoading = { ...this._forecastOptionsLoading, [type]: true };\n            }\n          } catch (_err) {\n            // ignore subscription errors to avoid breaking the editor\n          }\n        } else {\n          const hasOptions = type === \"hourly\" ? this._hourlyExtraOptions.length : this._dailyExtraOptions.length;\n          this._forecastOptionsLoading = { ...this._forecastOptionsLoading, [type]: !hasOptions };\n        }\n      });\n    } catch (_err) {\n      // Fall back to attribute-based detection to keep the editor alive\n      try {\n        if (this.hass && this._config?.entity) {\n          this._applyForecastOptionsFromAttributes(this.hass.states[this._config.entity] as any);\n        }\n      } catch (_e) {\n        // ignore\n      }\n    }\n  }\n\n  private _handleForecastOptionsEvent(type: ModernForecastType, event: ForecastEvent) {\n    const entries = Array.isArray(event?.forecast) ? event.forecast : [];\n    if (!entries.length) {\n      return;\n    }\n\n    const disallowedHourly = new Set([\"datetime\", \"condition\", \"precipitation\", \"temperature\", \"templow\"]);\n    const disallowedDaily = disallowedHourly;\n    const keys = new Set<string>();\n\n    entries.forEach(entry => {\n      if (entry && typeof entry === \"object\") {\n        Object.keys(entry).forEach(key => {\n          const block = type === \"hourly\" ? disallowedHourly : disallowedDaily;\n          if (!block.has(key)) {\n            keys.add(key);\n          }\n        });\n      }\n    });\n\n    const next = Array.from(keys).sort((a, b) => a.localeCompare(b));\n    if (type === \"hourly\") {\n      if (next.join(\"|\") !== this._hourlyExtraOptions.join(\"|\")) {\n        this._hourlyExtraOptions = next;\n      }\n      this._forecastOptionsLoading = { ...this._forecastOptionsLoading, hourly: false };\n    } else {\n      if (next.join(\"|\") !== this._dailyExtraOptions.join(\"|\")) {\n        this._dailyExtraOptions = next;\n      }\n      this._forecastOptionsLoading = { ...this._forecastOptionsLoading, daily: false };\n    }\n\n    this._cacheForecastOptions();\n  }\n\n  private _applyForecastOptionsFromAttributes(stateObj: any) {\n    if (!stateObj?.attributes?.forecast) {\n      return;\n    }\n    const entries = Array.isArray(stateObj.attributes.forecast) ? stateObj.attributes.forecast : [];\n    if (!entries.length) {\n      return;\n    }\n\n    const disallowed = new Set([\"datetime\", \"condition\", \"precipitation\", \"temperature\", \"templow\"]);\n    const keys = new Set<string>();\n    entries.forEach(entry => {\n      if (entry && typeof entry === \"object\") {\n        Object.keys(entry).forEach(key => {\n          if (!disallowed.has(key)) {\n            keys.add(key);\n          }\n        });\n      }\n    });\n\n    const options = Array.from(keys).sort((a, b) => a.localeCompare(b));\n    if (options.join(\"|\") !== this._hourlyExtraOptions.join(\"|\")) {\n      this._hourlyExtraOptions = options;\n    }\n    if (options.join(\"|\") !== this._dailyExtraOptions.join(\"|\")) {\n      this._dailyExtraOptions = options;\n    }\n    this._forecastOptionsLoading = { ...this._forecastOptionsLoading, hourly: false, daily: false };\n\n    this._cacheForecastOptions();\n  }\n\n  private _cacheForecastOptions() {\n    if (!this._forecastOptionsEntity) {\n      return;\n    }\n    if (!this._hourlyExtraOptions.length && !this._dailyExtraOptions.length) {\n      return;\n    }\n    FORECAST_OPTIONS_CACHE.set(this._forecastOptionsEntity, {\n      hourly: [...this._hourlyExtraOptions],\n      daily: [...this._dailyExtraOptions],\n    });\n  }\n\n  private _getSupportedForecastTypes(stateObj: any): ModernForecastType[] {\n    if (!stateObj?.attributes) {\n      return [];\n    }\n    const supported: ModernForecastType[] = [];\n    const features = stateObj.attributes.supported_features ?? 0;\n    if ((features & WeatherEntityFeature.FORECAST_DAILY) !== 0) {\n      supported.push(\"daily\");\n    }\n    if ((features & WeatherEntityFeature.FORECAST_TWICE_DAILY) !== 0) {\n      supported.push(\"twice_daily\");\n    }\n    if ((features & WeatherEntityFeature.FORECAST_HOURLY) !== 0) {\n      supported.push(\"hourly\");\n    }\n    return supported;\n  }\n\n  private _subscribeForecast(\n    entityId: string,\n    forecastType: ModernForecastType,\n    callback: (event: ForecastEvent) => void,\n  ): Promise<() => void> | undefined {\n    if (!this.hass?.connection) {\n      this._applyForecastOptionsFromAttributes(this.hass.states[entityId] as any);\n      return undefined;\n    }\n\n    return this.hass.connection\n      .subscribeMessage<ForecastEvent>(callback, {\n        type: \"weather/subscribe_forecast\",\n        forecast_type: forecastType,\n        entity_id: entityId,\n      })\n      .catch(() => undefined);\n  }\n\n  private _teardownForecastOptionSubscriptions(types?: ModernForecastType[]) {\n    const targets = types ?? ([\"hourly\", \"daily\"] as ModernForecastType[]);\n    targets.forEach(type => {\n      const sub = this._forecastOptionSubscriptions[type];\n      sub?.then(unsub => unsub?.()).catch(() => undefined);\n      delete this._forecastOptionSubscriptions[type];\n      this._forecastOptionsLoading = { ...this._forecastOptionsLoading, [type]: false };\n    });\n  }\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._teardownForecastOptionSubscriptions();\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"weather-forecast-extended-editor\": WeatherForecastExtendedEditor;\n  }\n}\n","// Collection of types from HA frontend\n\nimport type { ActionConfig, LovelaceCardConfig } from \"custom-card-helpers\";\n\n// From frontend/src/panels/lovelace/types.ts\nexport interface LovelaceGridOptions {\n  columns?: number | \"full\";\n  rows?: number | \"auto\";\n  max_columns?: number;\n  min_columns?: number;\n  min_rows?: number;\n  max_rows?: number;\n}\n\nexport interface WeatherForecastExtendedConfig extends LovelaceCardConfig {\n  type: \"custom:weather-forecast-extended-card\";\n  entity: string;\n  name?: string;\n  header_temperature_entity?: string;\n  nowcast_entity?: string;\n  nowcast_layout?: \"pager\" | \"inline\";\n  nowcast_always_show?: boolean;\n  header_chips?: HeaderChip[];\n  header_attributes?: string[];\n  icon_map?: WeatherIconMap;\n  show_header?: boolean;\n  hourly_forecast?: boolean;\n  daily_forecast?: boolean;\n  orientation?: \"vertical\" | \"horizontal\";\n  show_sun_times?: boolean;\n  sun_use_home_coordinates?: boolean;\n  sun_latitude?: number | string;\n  sun_longitude?: number | string;\n  use_night_header_backgrounds?: boolean;\n  daily_min_gap?: number;\n  hourly_min_gap?: number;\n  header_tap_action_temperature?: ActionConfig;\n  header_tap_action_condition?: ActionConfig;\n  hourly_extra_attribute?: string;\n  hourly_extra_attribute_unit?: string;\n  hourly_extra_attribute_color?: string;\n  hourly_extra_attribute_dim_below?: number;\n  daily_extra_attribute?: string;\n  daily_extra_attribute_unit?: string;\n  daily_extra_attribute_color?: string;\n  daily_extra_attribute_dim_below?: number;\n  solar_forecast_entries?: string[];\n  masonry_rows?: number;\n}\n\nexport const WEATHER_CONDITIONS = [\n  \"clear-night\",\n  \"cloudy\",\n  \"fog\",\n  \"hail\",\n  \"lightning\",\n  \"lightning-rainy\",\n  \"partlycloudy\",\n  \"partlycloudy-night\",\n  \"pouring\",\n  \"rainy\",\n  \"snowy\",\n  \"snowy-rainy\",\n  \"sunny\",\n  \"windy\",\n  \"windy-variant\",\n  \"exceptional\",\n] as const;\n\nexport type WeatherCondition = typeof WEATHER_CONDITIONS[number];\n\nexport type WeatherIconMap = Partial<Record<WeatherCondition, string>>;\n\nexport interface SunCoordinates {\n  latitude: number;\n  longitude: number;\n}\n\nexport type SunEventType = \"sunrise\" | \"sunset\";\n\nexport type SunTimesByDay = Record<string, Partial<Record<SunEventType, number>>>;\n\nexport type HeaderChip = AttributeHeaderChip | TemplateHeaderChip;\n\nexport interface AttributeHeaderChip {\n  type: \"attribute\";\n  attribute: string;\n  icon?: string;\n  tap_action?: ActionConfig;\n}\n\nexport interface TemplateHeaderChip {\n  type: \"template\";\n  template: string;\n  icon?: string;\n  tap_action?: ActionConfig;\n}\n"],"names":[],"version":3,"file":"weather-forecast-extended-editor.3d7dce5b.js.map"}